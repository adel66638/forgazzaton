                cell.bits.writeUint(0, 32); // Op-code للتحويل العادي
                cell.bits.writeAddress(new TonWeb.utils.Address(upline));

                const bocString = TonWeb.utils.bytesToBase64(await cell.toBoc());

                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: [
                        {
                            address: CONTRACT_ADDRESS,
                            amount: "500000000", // 0.5 TON بالنانو
                            payload: bocString
                        }
                    ]
                };

                await tonConnectUI.sendTransaction(transaction);
                alert("تم إرسال الطلب! سيتم توزيع الأرباح فور تأكيد الشبكة.");
            } catch (e) {
                console.error(e);
                alert("حدث خطأ في العملية.");
            }
        }

        function copyLink() {
            const link = document.getElementById('myRefLink').innerText;
            navigator.clipboard.writeText(link);
            alert("تم نسخ رابط الإحالة!");
        }
    </script>
</body>
</html>
