        </div>
    </div>

    <script>
        // الإعدادات - تأكد أن العناوين صحيحة هنا
        const CONTRACT_ADDRESS = "EQCflHDD-IqNofP4D2LzL_fX4XfX4XfX4XfX4uOrbFZha"; 
        const MY_WALLET = "EQCynb1kgfPUU-52BHZZMSKZu-TgXaPgjqXVVNOXqX0FZtr";

        const tonConnectUI = new TONConnectUI.TonConnectUI({
            manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp-with-react-ui/main/public/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });

        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                const userAddr = wallet.account.address;
                const link = window.location.origin + window.location.pathname + "?ref=" + userAddr;
                document.getElementById('myRefLink').innerText = link;
            }
        });

        async function upgradeLevel() {
            if (!tonConnectUI.connected) {
                alert("يرجى ربط المحفظة أولاً!");
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const upline = urlParams.get('ref') || MY_WALLET;

            try {
                const tonweb = new TonWeb();
                const cell = new TonWeb.boc.Cell();
                cell.bits.writeUint(0, 32); 
                cell.bits.writeAddress(new TonWeb.utils.Address(upline));

                const bocString = TonWeb.utils.bytesToBase64(await cell.toBoc());

                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: [
                        {
                            address: CONTRACT_ADDRESS,
                            amount: "500000000",
                            payload: bocString
                        }
                    ]
                };

                await tonConnectUI.sendTransaction(transaction);
                alert("تم إرسال الطلب بنجاح!");
            } catch (e) {
                console.error(e);
                alert("حدث خطأ أو تم إلغاء العملية.");
            }
        }

        function copyLink() {
            const link = document.getElementById('myRefLink').innerText;
            if(link.includes("...")) return alert("اربط المحفظة أولاً!");
            navigator.clipboard.writeText(link);
            alert("تم نسخ الرابط!");
        }
    </script>
</body>
</html>
