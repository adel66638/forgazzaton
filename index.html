<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZzaTon System</title>
    <style>
        /* هذا الجزء يضمن بقاء التصميم طبق الأصل كما في صورك */
        body { background-color: #0d0d0d; color: #ffffff; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .header { margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 500px; margin: 0 auto; }
        .card { background-color: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 15px; position: relative; }
        .level-tag { color: #0088cc; font-weight: bold; font-size: 14px; }
        .price-tag { font-size: 20px; margin: 10px 0; font-weight: bold; }
        .btn-upgrade { background-color: #0088cc; color: white; border: none; padding: 8px 0; width: 100%; border-radius: 6px; cursor: pointer; font-size: 14px; text-transform: uppercase; font-weight: bold; }
        .btn-upgrade:hover { background-color: #00aaff; }
    </style>
</head>
<body>

    <div class="header">
        <h1>ZZATON LEVELS</h1>
    </div>

    <div class="grid" id="levelsGrid">
        </div>

    <script>
        // جدول الأسعار الدقيق من صورك
        const prices = {
            1:1, 2:2, 3:4, 4:8, 5:10, 6:12, 7:21, 8:24, 9:30, 10:40,
            11:50, 12:60, 13:70, 14:80, 15:90, 16:100, 17:120, 18:150, 19:180, 20:200
        };

        // بناء الواجهة طبق الأصل
        const grid = document.getElementById('levelsGrid');
        for (let i = 1; i <= 20; i++) {
            grid.innerHTML += `
                <div class="card">
                    <div class="level-tag">Level ${i}</div>
                    <div class="price-tag">${prices[i]} TON</div>
                    <button class="btn-upgrade" onclick="requestUpgrade(${i})">Upgrade</button>
                </div>
            `;
        }

        // دالة الإرسال لتلجرام (المحرك)
        async function requestUpgrade(level) {
            const amount = prices[level];
            const userWallet = "UQ_USER_ADDR"; // ستتغير تلقائياً حسب المستخدم
            const refWallet = "UQ_REF_ADDR";   // محفظة المحيل

            // قاعدة الـ 50% التي طلبتها
            let target = (level === 1) ? userWallet : refWallet;
            let share = (level === 1) ? 0.2 : (amount * 0.5);
            let messageText = (level === 1) ? "إرجاع 0.2 TON للمشترك" : `إرسال ${share} TON للمحيل (50%)`;

            try {
                const response = await fetch('/api/notify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        level: level,
                        amount: amount,
                        wallet: target,
                        instruction: messageText
                    })
                });

                if (response.ok) {
                    alert("✅ تم إرسال الطلب للمسؤول بنجاح!");
                } else {
                    alert("❌ خطأ: تأكد من إعدادات Vercel");
                }
            } catch (err) {
                alert("⚠️ فشل الاتصال بالسيرفر");
            }
        }
    </script>
</body>
</html>
